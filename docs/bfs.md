# BFS

## CSES 1667

题意：给出一张无向无权图，求出从 $1$ 到 $N$ 的最短路径，并打印方案。

图论（树论）意义：

- 在 BFS 的过程中，实际上隐式地建立了一棵 BFS 搜索树。在 BFS 树中从 $1$ 到 $N$ 的路径是唯一的。
- 使用父亲表示法建立这棵树（每个点最多一个父亲），然后输出路径时从 $N$ 不断找父亲到根即可。

DP 意义：

- 记录当前状态由之前哪个状态转移而来。

## 洛谷 P1144

题意：给出一张无向无权图，求出从 $1$ 到其他所有点的最短路径数量。

思路 1（图论意义）：

- 可以先从 $1$ BFS 一遍，构造出 BFS 树。
- 记录 $dis_i$ 表示从 $1$ 到 $i$ 的最短路径长度，$f_i$ 表示从 $1$ 到 $i$ 的最短路径数量。
- 对于一条树边 $u \to v$，$f_v \gets f_v + f_u$
- 对于一条非树边 $u \to v$，如果 $dis_u < dis_v$（在 BFS 树上等价于 $dis_u + 1 = dis_v$），则 $f_v \gets f_v + f_u$
  - 非树边在 BFS 树上只会连接相邻两层或同层的结点。

思路 2（DP 意义）：

- 记录 $dis_i$ 表示从 $1$ 到 $i$ 的最短路径长度，$f_i$ 表示从 $1$ 到 $i$ 的最短路径数量。
- 可以直接在 BFS 的过程中顺便求出方案数。
- 对于边 $u \to v$，如果点 $v$ 第一次被 $u$ 转移到，$f_v \gets f_u$。
- 如果一个点 $v$ 不是第一次被转移到，但可以 $(u, v)$ 是可以是最短路径上的一部分，累加方案数 $f_v \gets f_u + f_v$。

## 多源 BFS

agc033_a

题意：$N \times M$ 的网格图上有若干个黑色格子，没过一秒所有与黑色格子相邻的白色格子就会变黑色，求出多少秒后所有格子变黑色。

思路：求出每个白色格子 $(x, y)$ 到最近的黑色格子的距离 $dist_{x, y}$，求出所有白色格子的 $dist_{x, y}$ 的最大值，就是答案。

直接从每个白色格子出发，做 BFS，找到一个黑色格子就停下。时间复杂度最坏为 $O((NM)^2)$。

换一种思路，从每个黑色格子出发，去 BFS 到离它最远的白色格子的距离。时间复杂度仍然不变。

考虑新建一个超级源点，这个源点连接所有的黑色格子，然后以这个源点为起点做 BFS，此时从该起点到白色格子的距离就意味着某个黑色格子到白色格子的最短距离。

实际上不需要建立超级源点，只需要一开始将所有的黑色格子全部放进 BFS 的队列中即可。这种 BFS 称为多源 BFS。