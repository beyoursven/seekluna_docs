# 模运算与同余

问题：$-7$ 除以 $3$ 的商和余数，到底是 $-2, -1$，还是 $-3, 2$。

## 取模运算

在信息学的数学中，我们一般按照如下定义取模运算：

- 给定**整数** $a$ 和**非零整数** $b$，可以证明存在两个唯一的整数 $q$ 和 $r$，满足 $a = q \times b + r$，并且 $0 \le r \lt |b|$。即，$a$ 除以 $b$ 的商和余数为 $q$ 和 $r$。
- 其中余数 $r$ 可以记作 $r = a \bmod b$，即 $a$ 对 $b$ 取模的结果为 $r$。$b$ 称为模数。
- 注意 $r$ 为**非负数**。

每个编程语言对取模运算的定义都有差异，**在 C++ 中，取模运算的结果跟随被除数，而在信息学输出取模结果一般都是非负数**。

也就是说，在 C++ 中，$-7$ 对 $3$ 取模结果为 $-1$，而题目要求你的输出结果为 $2$。

>
尝试输出 `7 % 3, 7 % -3, -7 % 3, -7 % -3` 的结果。

## 整除

如果**整数** $b$ 对**非零整数** $a$ 的取模结果为 $0$，则称 $a$ 整除 $b$，记作 $a \mid b$。如果 $b$ 除以 $a$ 不能除尽，则记作 $a \nmid b$。

例如，$2 \mid 4$，$-7 \mid 49$，$3 \mid -6$，$5 \mid 0$，$4 \nmid 9$。

在接下来的描述中，模数默认均为非零整数。

## 同余

### 定义

定义 $1$：若两个整数 $a, b$ 对 $m$ 取模的结果相同，则称 $a$ 和 $b$ 关于 $m$ 同余。

- 记作 $a \equiv b \pmod {m}$。

定义 $2$：若两个整数 $a, b$ 满足 $m \mid (a - b)$，则称 $a$ 和 $b$ 关于 $m$ 同余。

- 定义 $1$ 和定义 $2$ 是等价的。
- 上课讲解证明。

例如，$17 \equiv 31 \pmod 7$，$-7 \equiv 2 \pmod 3$。

### 基本性质

自反性：$a \equiv a \pmod m$。

对称性：如果 $a \equiv b \pmod m$，则 $b \equiv a \pmod m$。

传递性：如果 $a \equiv b \pmod m$，$b \equiv c \pmod m$，则 $a \equiv c \pmod m$。

取模结果相同的数构成了等价类。例如，在模 $4$ 的意义下，有四个等价类 $(0, 4, 8, \dots), (1, 5, 9, \dots), (2, 6, 10, \dots), (3, 7, 11, \dots)$

例题：[循环字符串](http://ac.robo-maker.cn/d/junior/p/P1410)

### 运算性质

同余式加法：如果 $a \equiv b \pmod m$ 且 $c \equiv d \pmod m$，则 $a \pm c \equiv b \pm d \pmod m$。

同余式乘法：如果 $a \equiv b \pmod m$ 且 $c \equiv d \pmod m$，则 $ac \equiv bd \pmod m$。

幂运算：如果 $a \equiv b \pmod m$，则 $a^n \equiv b^n \pmod m$。其中 $n$ 为正整数。

小学奥数称其为余数可加、可减、可乘。运算性质咋证明？

题目要求最终结果取模后输出，并且题目只涉及到加减乘运算时，可以边运算边取模，而不是对运算结果最后取模，防止数据溢出：

- `(a + b) % m = (a % m + b % m) % m`
- `(a - b) % m = (a % m - b % m + m) % m`，注意减法取模结果可能为负数的问题。
  - 等价于 `((a - b) % m + m) % m`。

- `a * b % m = (a % m) * (b % m) % m`，在 C++ 中，乘法、除法、取模运算优先级相同，按从左往右的方式运算。

```cpp
int add(int a, int b) {
  a = (a + b) % m;
  if (a < 0) a += m;
  return a;
}

int mul(int a, int b) {
  a = a * b % m;
  if (a < 0) a += m;
  return a;
}
```

例题：[加减乘取模](http://ac.robo-maker.cn/d/junior/p/P1409)

上面讲同余时，同余式相除不成立，那如果题目涉及到除法运算，又要求最终结果取模，该咋办？（讲快速幂时在介绍）

- $\frac{a}{b} \bmod p \ne \frac{a \bmod p}{b \bmod p}$，$a = 12, b = 6, p = 3$。

## 例题

逐月 P1409 P1410，洛谷 P8739